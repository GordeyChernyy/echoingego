<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8">
    <title>Echoing Ego</title>
    <link rel="stylesheet" href="css/style.css">
    <script type="text/javascript" src="javascript/paper-full.js"></script>

    <!-- <script src="javascript/osc-browser.min.js"></script> -->
    <script type="text/paperscript" src="src/main.js" canvas="myCanvas"></script>
    <script src="http://127.0.0.1:8081/socket.io/socket.io.js"></script>
    <script>
    window.echoingEgo = {};

 	  var socket = io.connect('http://127.0.0.1', { port: 8081, rememberTransport: true});
   	  console.log('oi');
   	  socket.on('connect', function() {
        // sends to socket.io server the host/port of oscServer
        // and oscClient
	    socket.emit('config',
	        {
	            server: {
	                port: 3333,
	                host: '127.0.0.1'
	            },
	            client: {
	                port: 3334,
	                host: '127.0.0.1'
	            }
	        }
	    );
    });

   	window.echoingEgo.data = {}; 
   	var isOnce = true;
    socket.on('message', function(obj) {

    	parseOSCObj(obj)
    	if(isOnce){
			window.echoingEgo.initializeOnFrame();	
			isOnce = false;
    	}
		// paper.view.onFrame = function(event) { 
		// 	console.log(event);

		// }


        // window.skeletonPositionData = skeletonPositionData;
     // console.log(obj);
    });

    var parseOSCObj = function(obj){
    	var rootObj = obj[2]
    	var righthand_pos;
   		var lefthand_pos;
   		updatePositions(rootObj);
    }

    var updatePositions = function (rootObj) {
    	var name = rootObj[0]
    	var x = rootObj[1];
    	var y = rootObj[2];
		window.echoingEgo.data[name] = {x: x, y: y};	
    }

</script>
</head>
<body>
    <canvas id="myCanvas" resize ></canvas>
</body>
</html>
